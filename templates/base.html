<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Smart To-Do{% endblock %}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    :root{
      --fuchsia-blue: linear-gradient(90deg,#a44cff,#2f7bff);
      --mauve:#cfa3ff;
      --nav-bg:#a44cff;
    }
    html,body { height:100%; }
    body { font-family:'Poppins',sans-serif; background:#f5f7fb; color:#222; overflow-x:hidden; }
    .navbar-custom { background: var(--nav-bg); background-image: linear-gradient(90deg,#a44cff,#2f7bff); }
    .nav-btn { border-radius:10px; color:white; padding:8px 12px; display:flex; align-items:center; gap:8px; transition:background .15s; }
    .nav-btn:hover { background: var(--mauve); color:#3a145e; }
    .stats-card { border-radius:12px; padding:18px; background:#fff; box-shadow:0 6px 18px rgba(18,38,63,0.06); }
    .task-card { border-radius:12px; padding:14px; background:#fff; box-shadow:0 8px 20px rgba(10,10,20,0.05); display:flex; gap:12px; align-items:flex-start; overflow:hidden; }
    .task-desc { color:#555; font-size:0.95rem; max-height:4.6rem; overflow:hidden; text-overflow:ellipsis; word-break:break-word; }
    .task-title { font-weight:600; margin-bottom:6px; }
    .priority-high { border-left:6px solidrgb(245, 99, 83); }
    .priority-medium { border-left:6px solidrgb(238, 196, 29); }
    .priority-low { border-left:6px solidrgb(41, 236, 122); }
    .no-tasks { text-align:center; padding:60px 20px; color:#6c6c6c; }
    .no-tasks .big { font-size:42px; margin-bottom:10px; }
    /* Prevent long text causing horizontal scroll */
    .container-fluid, .container { max-width:1180px; }
    /* Add Task floating button bottom-left */
    .add-fab { position:fixed; left:18px; bottom:18px; z-index:1200; border-radius:14px; padding:12px 16px; background:#fff; color:var(--nav-bg); box-shadow:0 8px 20px rgba(0,0,0,0.12); display:flex; gap:8px; align-items:center; cursor:pointer; }
    .logout-fixed { position:fixed; right:18px; bottom:18px; z-index:1200; background:#ff6bcb; color:#fff; border-radius:10px; padding:10px 14px; box-shadow:0 8px 20px rgba(0,0,0,0.12); }
    /* Quick actions on hover */
    .task-actions { display:none; gap:6px; }
    .task-card:hover .task-actions { display:flex; }
    /* Expandable details */
    .task-details { display:none; }
    .task-card.expanded .task-details { display:block; margin-top:8px; }
    /* Dark mode */
    body.dark { background:rgb(38, 37, 38); color: rgb(15,15,15); }
    body.dark .task-card { background-color:rgb(243, 237, 237); box-shadow:none; }
    .task-light { background-color:rgb(243, 233, 233); color: #333; }
    .task-dark { background-color:rgb(22, 22, 22); color:rgb(219, 214, 214); }
    .completed {
    text-decoration: color: rgb(150,150,150);
    opacity: 0.1;}
  </style>
  {% block head %}{% endblock %}
</head>
<body class="{% if dark_mode %}dark{% endif %}">
  <nav class="navbar navbar-expand-lg navbar-custom py-2 {% if dark_mode %}bg-dark{% else %}bg-fuchsia {% endif %}">
  <div class="container">
    <a class="navbar-brand fw-bold {% if dark_mode %}text-light{% else %}text-white{% endif %}" href="{{ url_for('index') }}">âœ¨ Smart To-Do</a>

    <div class="d-flex align-items-center gap-2">
      <a class="nav-btn me-1 {% if dark_mode %}text-light{% else %}text-white{% endif %}" href="{{ url_for('index') }}"><i class="bi bi-house"></i> Home</a>
      <a class="nav-btn me-1 {% if dark_mode %}text-light{% else %}text-white{% endif %}" href="{{ url_for('workflow') }}"><i class="bi bi-kanban"></i> Workflow</a>
      <a class="nav-btn me-1 {% if dark_mode %}text-light{% else %}text-white{% endif %}" href="{{ url_for('completed') }}"><i class="bi bi-check2-all"></i> Completed</a>
      <a class="nav-btn me-1 {% if dark_mode %}text-light{% else %}text-white{% endif %}" href="{{ url_for('pending') }}"><i class="bi bi-clock"></i> Pending</a>

      <button class="btn btn-sm {% if dark_mode %}btn-light text-dark{% else %}btn-light{% endif %} ms-3" onclick="location.href='{{ url_for('toggle_theme') }}'">
        <i class="bi bi-moon"></i>
      </button>
    </div>
  </div>
</nav>


  <div class="container my-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, msg in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ msg }} <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </div>

  <!-- Add Task FAB -->
  <div class="add-fab" data-bs-toggle="modal" data-bs-target="#addTaskModal">
    <i class="bi bi-plus-lg" style="font-size:18px"></i>
    <span style="font-weight:600">Create</span>
  </div>

  <!-- Logout fixed -->
  <a href="{{ url_for('logout') }}" class="logout-fixed"><i class="bi bi-box-arrow-right"></i> Logout</a>

  <!-- Add Task Modal (shared) -->
  <div class="modal fade" id="addTaskModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <form method="POST" action="{{ url_for('add') }}" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create Task</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row g-2">
            <div class="col-md-8">
              <input name="title" class="form-control mb-2" placeholder="Title" required>
              <textarea name="desc" class="form-control mb-2" placeholder="Description"></textarea>
            </div>
            <div class="col-md-4">
              <label class="small text-muted">Due date</label>
              <input name="due" type="datetime-local" class="form-control mb-2">
              <label class="small text-muted">Priority</label>
              <select name="priority" class="form-select mb-2">
                <option value="High">High</option>
                <option value="Medium" selected>Medium</option>
                <option value="Low">Low</option>
              </select>
              <div class="form-check">
                <input class="form-check-input" name="reminder" type="checkbox" id="remSet">
                <label class="form-check-label small" for="remSet">Send reminder</label>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary">Add Task</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  {% block scripts %}{% endblock %}
</body>
</html>
